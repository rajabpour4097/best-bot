# تغییرات مدیریت ریسک پویا (Dynamic Risk Management)

## خلاصه تغییرات

مطابق درخواست شما، سیستم مدیریت ریسک پویا به شرح زیر به‌روزرسانی شد:

### سیستم قبلی:
- 4 مرحله: پوشش کمیسیون، 0.5R، 1.0R، 1.5R

### سیستم جدید:
- 12 مرحله بر اساس R (Risk/Reward ratio)
- هر مرحله Stop Loss را به نقطه trigger منتقل کرده و Take Profit را 0.5R افزایش می‌دهد

## جزئیات مراحل جدید:

| مرحله | Trigger Point | Stop Loss جدید | Take Profit جدید | نسبت R:R |
|--------|---------------|----------------|------------------|----------|
| 1      | 1.0R          | 1.0R           | 1.5R            | 1.5:1    |
| 2      | 1.5R          | 1.5R           | 2.0R            | 2.0:1    |
| 3      | 2.0R          | 2.0R           | 2.5R            | 2.5:1    |
| 4      | 2.5R          | 2.5R           | 3.0R            | 3.0:1    |
| 5      | 3.0R          | 3.0R           | 3.5R            | 3.5:1    |
| 6      | 3.5R          | 3.5R           | 4.0R            | 4.0:1    |
| 7      | 4.0R          | 4.0R           | 4.5R            | 4.5:1    |
| 8      | 4.5R          | 4.5R           | 5.0R            | 5.0:1    |
| 9      | 5.0R          | 5.0R           | 5.5R            | 5.5:1    |
| 10     | 5.5R          | 5.5R           | 6.0R            | 6.0:1    |
| 11     | 6.0R          | 6.0R           | 6.5R            | 6.5:1    |
| 12     | 6.5R          | 6.5R           | 7.0R            | 7.0:1    |

## فایل‌های تغییریافته:

### 1. `metatrader5_config.py`
- بخش `DYNAMIC_RISK_CONFIG` به‌روزرسانی شد
- 12 مرحله جدید اضافه شد
- مراحل کمیسیون و 0.5R حذف شدند

### 2. `main_metatrader.py`
- منطق مدیریت مراحل کمیسیون حذف شد
- فقط مراحل R-based باقی ماندند
- پیام‌های لاگ بهتری اضافه شد

### 3. `test_dynamic_risk.py` (جدید)
- فایل تست برای بررسی صحت تنظیمات
- شبیه‌سازی عملکرد سیستم جدید

## مزایای سیستم جدید:

1. **مدیریت ریسک بهتر**: با انتقال stop loss به نقطه ورود پس از 1.0R، ریسک اولیه از بین می‌رود
2. **افزایش تدریجی سود**: هر مرحله فرصت کسب سود بیشتری فراهم می‌کند
3. **انعطاف‌پذیری بالا**: 12 مرحله امکان بهره‌برداری از trend های قوی را فراهم می‌کند
4. **حفظ سود**: در هر مرحله، سود قبلی محفوظ می‌ماند

## نحوه عملکرد:

1. پوزیشن با stop loss اولیه باز می‌شود
2. وقتی قیمت به 1.0R برسد، stop loss به نقطه ورود (1.0R) منتقل شده و take profit به 1.5R تنظیم می‌شود
3. این فرآیند تا 6.5R ادامه می‌یابد
4. در صورت trigger شدن هر مرحله، پیامی در لاگ نمایش داده می‌شود

## تست سیستم:

برای تست سیستم جدید:
```bash
python3 test_dynamic_risk.py
```

این فایل تست تنظیمات را بررسی کرده و شبیه‌سازی کاملی از عملکرد سیستم ارائه می‌دهد.
